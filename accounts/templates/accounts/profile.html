{% extends 'base.html' %}
{% load static %}
{% block link %}
  <link rel="stylesheet" href="{% static 'css/profile.css' %}" type="text/css">
{% endblock link %}

{% block content %}

<div class="container my-5">
  <div class="d-flex justify-content-center align-items-center mb-4">
    <div>
      {% if user.profile.image|slugify|slice:'0:4' == 'http' %}
        <!-- 깃허브에서 가져온 이미지: https로 시작 -->
        <img src="{{ user.profile.image }}" style="border-radius: 70%; max-width: 200px;" alt="">
      {% elif user.profile.image %}
        <!-- 파일로 추가한 이미지 /media/ -->
        <img src="{{ user.profile.image.url }}" style="border-radius: 70%; max-width: 200px;" alt="">
      {% else %}
        <img src="{% static 'images/no-avatar.jpg' %}" style="border-radius: 70%; max-width: 200px;" alt="">
      {% endif %}
      {% comment %} <button id="emoji_btn">이모지 추가<input type="text" id="message" style="border-radius: 70%; width: 30px;" class="position-absolute top-1 start-10"></button> {% endcomment %}
    </div>
    <div class="ms-5 w-100">
      <div class="d-flex align-items-center mb-2">
        <h1 class="mb-0" style="font-size: 30px;">{{ user.profile.nickname }}님의 프로필</h1>
        <!-- 회원 정보 수정 & 팔로우 버튼 -->
        {% if user == request.user %}
        <a href="{% url 'accounts:profile_update' user.pk %}">
          <input type="submit" class="btn ms-3 follow-btn-hover color-2" style="width: 100%; height: 40px; background-color: #f37c2c; color: white;" value="프로필 수정">
        </a>
        {% elif request.user.is_authenticated %}
          <form id="follow-form" data-user-id="{{ user.pk }}">
            {% csrf_token %}
            {% if request.user in user.followers.all %}
              <input id="follow-btn" type="submit" class="btn ms-3 follow-btn-hover color-2" style="width: 100%; height: 40px; background-color: #f37c2c; color: white;" value="언팔로우">
            {% else %}
              <input id="follow-btn" type="submit" class="btn ms-3 follow-btn-hover color-2" style="width: 100%; height: 40px; background-color: #f37c2c; color: white;" value="팔로우">
            {% endif %}
          </form>
        {% endif %}
      </div>

      <p class="text-primary mb-1">
        <a type="button" data-bs-toggle="modal" data-bs-target="#followerModal">팔로워 <span id="followers-count">{{ user.followers.count }}</span></a>
        <a type="button" data-bs-toggle="modal" data-bs-target="#followingModal">팔로잉 <span id="followings-count">{{ user.followings.count }}</span></a>
      </p>
      {% if user.profile.language == 'Python' %}
      <p class="mb-1"><img src="https://img.shields.io/badge/Python-3776AB?style=flat&logo=Python&logoColor=ffffff"/></p>
      {% elif user.profile.language == 'Java' %}
      <p class="mb-1"><img src="https://img.shields.io/badge/java-007396?style=flat&logo=java&logoColor=white"></p>
      {% elif user.profile.language == 'C' %}
      <p class="mb-1"><img src="https://img.shields.io/badge/C-A8B9CC?style=flat&logo=C&logoColor=white"></p>
      {% endif %}
      <p class="mb-1"><span class="{{ user.profile.mbti }}-badge">{{ user.profile.mbti }}</span></p>
      <p class="mb-1">{{ user.profile.intro }}</p>
    </div>
  </div>
  <hr>
  <div class="d-flex flex-wrap justify-content-center flex-column">
    <!-- username: jupiter6676 -->
    <!-- 16진수 색상표 https://jasmintime.com/244 -->
    <!-- <img src="https://ghchart.rshah.org/6495ed/{{ user.profile.github_id }}" class="w-100"> -->
    {% if user.profile.github_id %}
    <img src="https://ghchart.rshah.org/{{ user.profile.github_id }}" class="w-100 mb-3">
    {% endif %}
    <h5>작성 글</h5>
    <h5>작성 댓글</h5>
    <a href="{% url 'accounts:guestbook' user.pk %}">
      <h5>방명록</h5>
    </a>
  </div>

  <!-- 팔로워 modal -->
  <div class="modal fade" id="followerModal" tabindex="-1" aria-labelledby="exampleModalLabel2" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel2">팔로워 목록</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body py-2">
          {% for follower in followers %}
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center my-3">
              <div class="mx-3">
                <a href="{% url 'accounts:profile' follower.pk %}">
                  {% if follower.profile.image|slugify|slice:'0:4' == 'http' %}
                  <!-- 깃허브에서 가져온 이미지: https로 시작 -->
                  <img src="{{ follower.profile.image }}" style="border-radius: 70%; max-width: 50px;" alt="">
                  {% elif follower.profile.image %}
                  <!-- 파일로 추가한 이미지 /media/ -->
                  <img src="{{ follower.profile.image.url }}" style="border-radius: 70%; max-width: 50px;" alt="">
                  {% else %}
                  <img src="{% static 'images/no-avatar.jpg' %}" style="border-radius: 70%; max-width: 50px;" alt="">
                  {% endif %}
                </a>
              </div>
              <div>
                <a href="{% url 'accounts:profile' follower.pk %}">
                  <p class="mb-0"><b>{{ follower.profile.nickname }}</b></p>
                  <p class="mb-0" style="font-size: 13px;">{{ follower }}</p>
                </a>
              </div>
            </div>
            <div class="me-3">
              {% if request.user.is_authenticated %}
              <form id="follow-form" data-user-id="{{ user.pk }}">
                {% csrf_token %}
                {% if request.user in follower.user.followers.all %}
                  <input id="follow-btn" type="submit" class="btn px-3" style="width: 100%; height: 40px; background-color: #f37c2c; color: white;" value="언팔로우">
                {% else %}
                  <input id="follow-btn" type="submit" class="btn px-3" style="width: 100%; height: 40px; background-color: #f37c2c; color: white;" value="팔로우">
                {% endif %}
              </form>
              {% endif %}                 
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  
  <!-- 팔로잉 modal -->
  <div class="modal fade" id="followingModal" tabindex="-1" aria-labelledby="exampleModalLabel3" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel3">팔로잉 목록</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body py-2">
          {% for following in followings %}
          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center my-3">
              <div class="mx-3">
                <a href="{% url 'accounts:profile' following.pk %}">
                  {% if following.profile.image|slugify|slice:'0:4' == 'http' %}
                  <!-- 깃허브에서 가져온 이미지: https로 시작 -->
                  <img src="{{ following.profile.image }}" style="border-radius: 70%; max-width: 50px;" alt="">
                  {% elif following.profile.image %}
                  <!-- 파일로 추가한 이미지 /media/ -->
                  <img src="{{ following.profile.image.url }}" style="border-radius: 70%; max-width: 50px;" alt="">
                  {% else %}
                  <img src="{% static 'images/no-avatar.jpg' %}" style="border-radius: 70%; max-width: 50px;" alt="">
                  {% endif %}
                </a>
              </div>
              <div>
                <a href="{% url 'accounts:profile' following.pk %}">
                  <p class="mb-0"><b>{{ following.profile.nickname }}</b></p>
                  <p class="mb-0" style="font-size: 13px;">{{ following }}</p>
                </a>
              </div>
            </div>
            <div class="me-3">
              {% if request.user.is_authenticated %}
              <form id="follow-form" data-user-id="{{ user.pk }}">
                {% csrf_token %}
                {% if request.user in following.followers.all %}
                  <input id="follow-btn" type="submit" class="btn px-3" style="width: 100%; height: 40px; background-color: #f37c2c; color: white;" value="언팔로우">
                {% else %}
                  <input id="follow-btn" type="submit" class="btn px-3" style="width: 100%; height: 40px; background-color: #f37c2c; color: white;" value="팔로우">
                {% endif %}
              </form>
              {% endif %}                 
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

{% block script %}
  <script type="text/javascript" src="{% static 'js/accounts_follow_async.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@3.0.3/dist/index.min.js"></script>
  {% comment %} <script>
    const button = document.querySelector("#emoji_btn");
    const picker = new EmojiButton({
      position: 'bottom-start'
    });
    
    button.addEventListener('click', () => {
      picker.togglePicker(button);
    });
    
    picker.on('emoji', emoji => {
      const text_box = document.querySelector('#message');
      text_box.value += emoji;
    });
  </script> {% endcomment %}
{% endblock script %}