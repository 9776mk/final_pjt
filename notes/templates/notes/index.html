{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block content%}
  <div class="container mt-5">
    <div id="main_in" class="row">
      <div class="col-3">
        <table class="table bg-white">
          <thead>
            <tr>
              <th scope="col"><a href="{% url 'notes:send' %}">쪽지 쓰기</a></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th scope="row"><a href="{% url 'notes:index' %}">받은 쪽지함</a></th>
            </tr>
            <tr>
              <th scope="row"><a href="{% url 'notes:sent' %}">보낸 쪽지함</a></th>
            </tr>
            <tr>
              <th scope="row"><a href="{% url 'notes:index' %}">중요 쪽지함</a></th>
            </tr>
            <tr>
              <th scope="row"><a href="{% url 'notes:index' %}">휴지통</a></th>
            </tr>
          </tbody>
        </table>
      </div>
      {% if request.resolver_match.url_name == 'index' %}
      <div class="col-9">
        <table class="table bg-white">
          <thead>
            <th class="fw-bold">받은 쪽지함</th>
            <tr>
              <th scope="col">보낸 사람</th>
              <th scope="col">제목</th>
              <th scope="col">받은 시간</th>
              <th scope="col">읽음</th>
              <th scope="col">삭제</th>
            </tr>
          </thead>
          <tbody>
            {% for note in notes %}
              <!-- 쪽지 읽음 일때 -->
              {% if note.read == 1 %}
              <tr class="text-muted" id="{{note.pk}}">
                <td>
                  {% if note.from_user.nickname %}
                    {{ note.from_user.nickname }}
                  {% else %}
                    {{ note.from_user.username }}
                  {% endif %}
                </td>
                <td><a class="text-muted" href="{% url 'notes:detail' note.pk %}">{{ note.title }}</a></td>
                <td>{{ note.created_at|date:'o.m.d H:i' }}</td>
                {% if note.read == 1 %}
                <td>읽음</td>
                {% else %}
                <td>안읽음</td>
                {% endif %}
                <td>
                  <a href="{% url 'notes:delete' note.pk %}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                    <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5Zm-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5ZM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06Zm6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528ZM8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5Z"/>
                  </svg></a>
                </td>
              </tr>
              {% else %}
              <!-- 쪽지 안읽음 일때-->
              <tr id="{{note.pk}}">
                <td>
                  {% if note.from_user.nickname %}
                    {{note.from_user.nickname}}
                  {% else %}
                    {{note.from_user.username}}
                  {% endif %}
                </td>
                <td><a href="{% url 'notes:detail' note.pk %}" class="fw-bold">{{ note.title }}</a></td>
                <td>{{ note.created_at|date:'o.m.d H:i' }}</td>
                {% if note.read == 1 %}
                <td>읽음</td>
                {% else %}
                <td>안읽음</td>
                {% endif %}
                <td>
                  <a href="{% url 'notes:delete' note.pk %}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                    <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5Zm-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5ZM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06Zm6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528ZM8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5Z"/>
                  </svg></a>
                </td>
              </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% elif request.resolver_match.url_name == 'sent' %}
      <div class="col-9">
        <table class="table bg-white">
          <thead>
            <th class="fw-bold">보낸 쪽지함</th>
            <tr>
              <th scope="col">받는 사람</th>
              <th scope="col">제목</th>
              <th scope="col">받은 시간</th>
              <th scope="col">읽음</th>
              <th scope="col">삭제</th>
            </tr>
          </thead>
          <tbody>
            {% for note in to_notes %}
              <!-- 쪽지 읽음 일때 -->
              {% if note.read == 1 %}
              <tr class="text-muted" id="{{note.pk}}">
                <td>
                  {% if note.to_user.nickname %}
                    {{ note.to_user.nickname }}
                  {% else %}
                    {{ note.to_user.username }}
                  {% endif %}
                </td>
                <td><a class="text-muted" href="{% url 'notes:detail' note.pk %}">{{ note.title }}</a></td>
                <td>{{ note.created_at|date:'o.m.d H:i' }}</td>
                {% if note.read == 1 %}
                <td>읽음</td>
                {% else %}
                <td>안읽음</td>
                {% endif %}
                <td>
                  <a href="{% url 'notes:delete' note.pk %}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                    <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5Zm-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5ZM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06Zm6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528ZM8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5Z"/>
                  </svg></a>
                </td>
              </tr>
              {% else %}
              <!-- 쪽지 안읽음 일때-->
              <tr id="{{note.pk}}">
                <td>
                  {% if note.from_user.nickname %}
                    {{note.from_user.nickname}}
                  {% else %}
                    {{note.from_user.username}}
                  {% endif %}
                </td>
                <td><a href="{% url 'notes:detail' note.pk %}" class="fw-bold">{{ note.title }}</a></td>
                <td>{{ note.created_at|date:'o.m.d H:i' }}</td>
                {% if note.read == 1 %}
                <td>읽음</td>
                {% else %}
                <td>안읽음</td>
                {% endif %}
                <td>
                  <a href="{% url 'notes:delete' note.pk %}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                    <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5Zm-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5ZM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06Zm6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528ZM8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5Z"/>
                  </svg></a>
                </td>
              </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}
    </div>
  </div>
{% endblock content %}

{% block script %}
{% comment %} <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  function remove(event) {
  console.log(event.target.dataset.noteId)
  var delete_warning = confirm('쪽지를 삭제하시겠습니까?')
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value
  if (delete_warning == true) {
    axios({
      method: 'post',
      url: `/notes/${event.target.dataset.noteId}/delete/`,
      headers: {'X-CSRFToken': csrftoken},
      data: {'note_pk': event.target.dataset.noteId},
    })
    .then(response => {
      const resdata = response.data.pk
      const div = document.getElementById(resdata)
      console.log(div)
      div.remove()
    })
  }
}
</script> {% endcomment %}
{% endblock script %}